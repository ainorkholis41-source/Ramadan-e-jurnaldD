<!DOCTYPE html>
<html lang="id">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.5, user-scalable=yes">
  <title>e-Jurnal Ramadan ¬∑ Luminous Night Premium+</title>
  <!-- Font Awesome 6 -->
  <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.0.0-beta3/css/all.min.css">
  <!-- Google Fonts: Inter & Amiri -->
  <link href="https://fonts.googleapis.com/css2?family=Inter:wght@300;400;500;600;700&family=Amiri:wght@400;700&display=swap" rel="stylesheet">
  <style>
    /* ========== RESET & VARIABEL ========== */
    * { margin: 0; padding: 0; box-sizing: border-box; }
    :root {
      --bg-dark: #0a1f3b;
      --bg-medium: #0d2a4a;
      --bg-light: #123b5e;
      --gold: #ffd966;
      --gold-light: #ffeaa5;
      --gold-soft: #ffb74d;
      --blue-magic: #74b9ff;
      --glass-bg: rgba(10, 30, 50, 0.65);
      --glass-border: rgba(255, 245, 200, 0.2);
      --toast-success: #00b894;
      --toast-error: #d63031;
      --shadow-heavy: 0 20px 40px rgba(0,0,0,0.4);
      --transition: all 0.25s cubic-bezier(0.25, 0.46, 0.45, 0.94);
    }
    body {
      background: radial-gradient(circle at 30% 10%, var(--bg-dark), var(--bg-medium), var(--bg-light));
      color: #f0f9ff;
      font-family: 'Inter', sans-serif;
      line-height: 1.5;
      min-height: 100vh;
      padding: 20px;
      position: relative;
      overflow-x: hidden;
    }
    /* ===== BULAN BERSINAR ===== */
    .moon {
      position: fixed; top: 5%; right: 8%;
      width: 200px; height: 200px;
      background: radial-gradient(circle at 35% 35%, #fffde7, #fff9c4, #ffe082);
      border-radius: 50%;
      box-shadow: 0 0 50px 30px rgba(255,243,158,0.6), 0 0 100px 60px rgba(255,235,120,0.3);
      animation: moonBreathing 7s ease-in-out infinite;
      z-index: 1; opacity: 0.8; pointer-events: none;
    }
    @keyframes moonBreathing {
      0% { box-shadow: 0 0 50px 30px rgba(255,243,158,0.6), 0 0 100px 60px rgba(255,235,120,0.3); transform: scale(1); }
      50% { box-shadow: 0 0 70px 40px rgba(255,255,200,0.9), 0 0 140px 80px rgba(255,241,140,0.5); transform: scale(1.02); }
      100% { box-shadow: 0 0 50px 30px rgba(255,243,158,0.6), 0 0 100px 60px rgba(255,235,120,0.3); transform: scale(1); }
    }
    .stars {
      position: fixed; top: 0; left: 0;
      width: 100%; height: 100%;
      pointer-events: none; z-index: 0;
    }
    .stars::after {
      content: ''; position: absolute;
      width: 4px; height: 4px;
      background: white; border-radius: 50%;
      box-shadow: 80px 120px white, 250px 300px rgba(255,255,200,0.9), 600px 180px white, 900px 70px rgba(255,255,210,0.8),
                  1100px 400px white, 200px 600px rgba(255,255,180,0.7), 700px 550px white, 1300px 200px white,
                  300px 800px white, 1000px 700px rgba(255,255,220,0.9), 400px 450px white, 1200px 550px white;
      animation: twinkle 6s infinite alternate;
    }
    @keyframes twinkle { 0% { opacity: 0.5; } 100% { opacity: 1; } }
    /* ===== KONTAINER UTAMA ===== */
    .portal-container {
      position: relative; z-index: 30;
      max-width: 1440px; margin: 0 auto;
      background: var(--glass-bg);
      backdrop-filter: blur(18px) saturate(180%);
      -webkit-backdrop-filter: blur(18px) saturate(180%);
      border-radius: 56px;
      padding: 30px 35px;
      box-shadow: var(--shadow-heavy), 0 0 0 1px var(--glass-border);
      border: 1px solid rgba(255,245,200,0.15);
    }
    /* ===== LOGO IDENTITAS (pojok kanan atas) ===== */
    .identity-logo {
      position: absolute;
      top: 25px;
      right: 35px;
      width: 56px;
      height: 56px;
      border-radius: 50%;
      background: rgba(255, 255, 245, 0.15);
      backdrop-filter: blur(8px);
      border: 2px solid rgba(255, 215, 100, 0.5);
      display: flex;
      justify-content: center;
      align-items: center;
      overflow: hidden;
      box-shadow: 0 0 20px rgba(255, 220, 100, 0.4);
      transition: var(--transition);
      z-index: 40;
    }
    .identity-logo:hover {
      transform: scale(1.05);
      border-color: var(--gold);
      box-shadow: 0 0 30px rgba(255, 200, 0, 0.6);
    }
    .identity-logo img {
      width: 100%;
      height: 100%;
      object-fit: cover;
      display: block;
    }
    .identity-logo i {
      font-size: 28px;
      color: var(--gold);
    }
    /* ===== HEADER ===== */
    .brand {
      display: flex; align-items: center; gap: 20px;
      margin-bottom: 20px; flex-wrap: wrap;
    }
    .logo-container {
      position: relative;
      width: 80px; height: 80px;
      border-radius: 20px;
      background: rgba(255,255,245,0.1);
      backdrop-filter: blur(8px);
      border: 2px solid var(--gold);
      display: flex; justify-content: center; align-items: center;
      overflow: hidden; box-shadow: 0 0 20px rgba(255,220,100,0.3);
    }
    #logoPreview { width: 100%; height: 100%; object-fit: cover; display: block; }
    .logo-placeholder { font-size: 42px; color: var(--gold); }
    .title-tagline h1 {
      font-size: 2rem; font-weight: 700;
      color: #fffbe3; text-shadow: 0 0 12px rgba(255,235,100,0.5);
      margin-bottom: 4px; font-family: 'Amiri', serif;
      letter-spacing: 0.5px;
    }
    .title-tagline p {
      font-size: 1rem; color: #e6f7ff;
      background: rgba(0,0,0,0.2); padding: 5px 18px;
      border-radius: 50px; display: inline-block;
      border-left: 6px solid var(--gold-soft);
      backdrop-filter: blur(4px);
    }
    /* ===== INFO RAMADHAN ===== */
    .ramadan-info-card {
      background: rgba(0, 0, 0, 0.2);
      backdrop-filter: blur(6px);
      border-radius: 60px;
      padding: 12px 25px;
      margin-top: 15px;
      display: inline-flex;
      align-items: center;
      gap: 15px;
      flex-wrap: wrap;
      border: 1px solid rgba(255, 215, 100, 0.3);
    }
    .ramadan-info-card span {
      display: flex;
      align-items: center;
      gap: 8px;
      color: #ffeaa5;
    }
    .ramadan-info-card i { color: var(--gold); }
    /* ===== MAIN TABS ===== */
    .main-tab-nav {
      display: flex; gap: 15px;
      margin: 20px 0 20px;
      border-bottom: 1px solid rgba(255,215,100,0.3);
      padding-bottom: 12px;
    }
    .main-tab-btn {
      background: transparent; border: none;
      padding: 12px 32px; font-size: 1rem; font-weight: 600;
      border-radius: 50px; color: #d9e9ff;
      display: flex; align-items: center; gap: 10px;
      cursor: pointer; transition: var(--transition);
      backdrop-filter: blur(6px); border: 1px solid transparent;
    }
    .main-tab-btn i { font-size: 1.1rem; }
    .main-tab-btn.active {
      background: rgba(255,225,140,0.25); color: #ffedb0;
      border: 1px solid var(--gold); box-shadow: 0 0 20px rgba(255,215,0,0.3);
    }
    .main-tab-btn:hover:not(.active) {
      background: rgba(200,230,255,0.15);
      border-color: rgba(255,230,140,0.6);
    }
    /* ===== INNER TABS ===== */
    .inner-tab-nav {
      display: flex; gap: 10px; margin: 15px 0 25px; flex-wrap: wrap;
    }
    .inner-tab-btn {
      background: rgba(0,0,0,0.3); border: 1px solid rgba(255,215,100,0.3);
      padding: 10px 24px; font-size: 0.95rem; font-weight: 500;
      border-radius: 40px; color: #e2f0ff;
      display: flex; align-items: center; gap: 8px;
      cursor: pointer; transition: var(--transition);
    }
    .inner-tab-btn.active {
      background: rgba(255,200,100,0.3); color: #fff4c2;
      border-color: var(--gold); box-shadow: 0 0 15px rgba(255,200,0,0.3);
    }
    .inner-tab-btn:hover:not(.active) {
      background: rgba(255,255,200,0.1);
      border-color: rgba(255,230,140,0.8);
    }
    /* ===== KONTEN ===== */
    .main-tab-content { display: none; animation: fadeSlide 0.35s ease; }
    .main-tab-content.active { display: block; }
    .inner-tab-content { display: none; }
    .inner-tab-content.active { display: block; }
    @keyframes fadeSlide {
      0% { opacity: 0; transform: translateY(8px); }
      100% { opacity: 1; transform: translateY(0); }
    }
    /* ===== SAMBUTAN ===== */
    .ramadan-quote {
      background: linear-gradient(145deg, rgba(20,60,85,0.85), rgba(10,45,65,0.95));
      padding: 30px 35px; border-radius: 60px 20px 60px 20px;
      margin-bottom: 20px; border-left: 12px solid var(--gold-soft);
      backdrop-filter: blur(8px);
    }
    .ramadan-quote h2 { font-size: 2.2rem; font-family: 'Amiri', serif; color: var(--gold-light); margin-bottom: 8px; }
    .ramadan-quote p { font-size: 1.2rem; font-style: italic; color: #f0fff0; }
    .welcome-principal {
      display: flex; gap: 30px; flex-wrap: wrap;
      background: rgba(25,65,90,0.65); border-radius: 48px;
      padding: 25px; align-items: center;
      backdrop-filter: blur(8px);
      border: 1px solid rgba(255,200,120,0.3);
    }
    .principal-photo {
      position: relative;
      width: 130px; height: 130px; border-radius: 50%;
      background: radial-gradient(circle, #ffe082, #ffb74d);
      display: flex; justify-content: center; align-items: center;
      font-size: 70px; color: #1e3b5a; border: 4px solid var(--gold);
      box-shadow: 0 0 30px #ffd966aa; overflow: hidden;
    }
    .speech { flex: 1; }
    .speech h3 { font-size: 1.8rem; color: #ffddaa; border-bottom: 2px dashed #fff3cd; padding-bottom: 10px; margin-bottom: 15px; }
    .speech p { font-size: 1.1rem; color: #f5f6fa; line-height: 1.7; }
    /* ===== VIDEO TUTORIAL ===== */
    .video-card {
      display: flex; align-items: center; gap: 30px;
      background: rgba(15,50,70,0.75); border-radius: 36px;
      padding: 20px 30px; flex-wrap: wrap;
      backdrop-filter: blur(8px);
      border: 1px solid rgba(255,220,100,0.3);
    }
    .video-frame {
      width: 280px; height: 158px; border-radius: 20px;
      overflow: hidden; box-shadow: 0 0 0 4px rgba(255,220,100,0.3);
    }
    .video-frame iframe { width: 100%; height: 100%; border: none; }
    .video-text h4 { font-size: 1.6rem; margin-bottom: 10px; color: #fff2bf; }
    /* ===== CARD GRID ===== */
    .filter-section {
      display: flex; align-items: center; gap: 20px;
      margin-bottom: 20px; flex-wrap: wrap;
    }
    .filter-select {
      background: rgba(10,35,55,0.85); border: 1px solid var(--gold);
      color: white; padding: 10px 25px; border-radius: 40px;
      font-size: 0.95rem; cursor: pointer; transition: var(--transition);
    }
    .filter-select:hover { border-color: var(--gold-light); background: rgba(20,45,65,0.9); }
    .class-grid {
      display: grid;
      grid-template-columns: repeat(auto-fill, minmax(320px, 1fr));
      gap: 20px;
      margin-bottom: 25px;
    }
    .class-card {
      background: rgba(0, 0, 0, 0.35);
      backdrop-filter: blur(8px);
      border-radius: 28px;
      padding: 20px;
      border: 1px solid rgba(255, 215, 100, 0.3);
      transition: var(--transition);
      box-shadow: 0 8px 16px rgba(0,0,0,0.2);
    }
    .class-card:hover {
      border-color: var(--gold);
      background: rgba(0, 0, 0, 0.45);
      transform: translateY(-4px);
      box-shadow: 0 12px 24px rgba(0,0,0,0.3);
    }
    .class-header { display: flex; justify-content: space-between; align-items: center; margin-bottom: 15px; padding-bottom: 8px; border-bottom: 1px dashed rgba(255,215,100,0.5); }
    .class-header h3 { font-size: 1.5rem; font-weight: 700; color: #ffefc0; }
    .class-header i { font-size: 1.8rem; color: var(--gold); }
    .rombel-links-card { display: flex; flex-direction: column; gap: 12px; }
    .rombel-item { display: flex; justify-content: space-between; align-items: center; padding: 6px 0; }
    .rombel-label { font-weight: 600; color: #fbffc4; min-width: 75px; }
    .rombel-actions { display: flex; gap: 12px; }
    .btn-link {
      display: inline-flex; align-items: center; gap: 6px;
      padding: 6px 16px; border-radius: 30px;
      font-size: 0.85rem; text-decoration: none; font-weight: 500;
      transition: var(--transition);
    }
    .btn-link i { font-size: 0.9rem; }
    .btn-sheet { background: rgba(70, 130, 200, 0.25); border: 1px solid var(--blue-magic); color: #cfe9ff; }
    .btn-sheet:hover { background: #0984e3; color: white; transform: scale(1.02); }
    .btn-canva { background: rgba(180, 70, 200, 0.25); border: 1px solid #e08eff; color: #e6d0ff; }
    .btn-canva:hover { background: #8e44ad; color: white; transform: scale(1.02); }
    .btn-canva-primary {
      background: radial-gradient(circle at 30% 30%, #ffb347, #ff8c42);
      padding: 16px 50px; border-radius: 60px;
      font-size: 1.3rem; font-weight: 700; color: #0a1f2e;
      border: 2px solid #ffe99b; box-shadow: 0 0 30px #ffb347cc;
      display: inline-flex; gap: 15px; align-items: center;
      text-decoration: none; margin: 10px 0; transition: var(--transition);
    }
    .btn-canva-primary:hover { background: radial-gradient(circle at 30% 30%, #ffa233, #ff6b2b); box-shadow: 0 0 50px #ffae42; transform: scale(1.03); }
    /* ===== FOOTER ===== */
    .footer {
      background: rgba(6,25,40,0.85); border-radius: 40px;
      padding: 25px 30px; display: flex; flex-wrap: wrap;
      justify-content: space-between; align-items: center; margin-top: 15px;
      backdrop-filter: blur(8px);
    }
    .footer-logo { display: flex; align-items: center; gap: 15px; }
    .footer-info h4 { font-size: 1.5rem; color: #fff3cd; }
    .social a {
      color: #ffe9b0; font-size: 28px; margin-left: 20px;
      transition: var(--transition); display: inline-block;
    }
    .social a:hover { color: var(--gold); transform: translateY(-4px); text-shadow: 0 0 12px rgba(255,255,200,0.8); }
    .copyright {
      text-align: center; margin-top: 20px; padding-top: 15px;
      border-top: 1px solid rgba(255,215,100,0.3);
      color: #c3e6ff; font-size: 0.9rem;
    }
    /* ===== PANEL PENGATURAN ===== */
    .settings-panel {
      background: rgba(7,35,50,0.8); backdrop-filter: blur(20px);
      padding: 30px; border-radius: 48px;
      max-height: 650px; overflow-y: auto;
      scrollbar-width: thin; scrollbar-color: var(--gold) rgba(0,0,0,0.2);
    }
    .settings-panel::-webkit-scrollbar { width: 6px; }
    .settings-panel::-webkit-scrollbar-track { background: rgba(0,0,0,0.2); border-radius: 10px; }
    .settings-panel::-webkit-scrollbar-thumb { background: var(--gold); border-radius: 10px; }
    .setting-group {
      background: rgba(255,255,255,0.07); border-radius: 32px;
      padding: 25px; margin-bottom: 25px;
      border: 1px solid rgba(255,215,100,0.1);
      transition: all 0.2s;
    }
    .setting-group:hover {
      border-color: rgba(255,215,100,0.6);
      background: rgba(25,55,75,0.8);
    }
    .setting-group h3 { color: #ffe189; margin-bottom: 20px; font-size: 1.5rem; display: flex; align-items: center; gap: 10px; }
    .field {
      display: flex; flex-wrap: wrap; align-items: center;
      gap: 15px; margin-bottom: 20px;
    }
    .field label { width: 170px; font-weight: 600; color: #fff0d0; letter-spacing: 0.3px; }
    .field input, .field textarea {
      flex: 1; padding: 12px 22px; background: rgba(0,0,0,0.3);
      border: 1px solid rgba(255,200,100,0.3); border-radius: 60px; color: white;
      transition: var(--transition);
    }
    .field input:focus, .field textarea:focus {
      border-color: #ffd966;
      box-shadow: 0 0 0 3px rgba(255,215,0,0.2);
      background: rgba(0,0,0,0.5);
      outline: none;
    }
    .field input[type="date"] { color-scheme: dark; }
    .field input[type="file"] { padding: 10px; }
    .btn-group { display: flex; gap: 20px; margin-top: 20px; flex-wrap: wrap; }
    .btn-primary, .btn-secondary, .btn-warning, .btn-danger {
      padding: 12px 30px; border-radius: 60px;
      font-weight: 700; cursor: pointer; border: none;
      display: inline-flex; align-items: center; gap: 10px;
      transition: var(--transition);
      font-size: 0.95rem;
    }
    .btn-primary { background: #f39c12; color: #0a1e2b; }
    .btn-primary:hover { background: #e67e22; box-shadow: 0 0 20px #ffb347; transform: scale(1.02); }
    .btn-secondary { background: rgba(255,255,255,0.12); color: #ffd966; border: 1px solid #ffd966; }
    .btn-secondary:hover { background: rgba(255,220,100,0.2); border-color: #ffeaa5; }
    .btn-warning { background: #e74c3c; color: white; }
    .btn-warning:hover { background: #c0392b; box-shadow: 0 0 20px #e74c3c; }
    .btn-danger { background: #7f8c8d; color: white; }
    .btn-danger:hover { background: #636e72; }
    .identity-preview {
      display: flex; align-items: center; gap: 15px;
      margin-top: 10px; padding: 10px; background: rgba(0,0,0,0.2); border-radius: 50px;
    }
    .identity-preview img, .identity-preview i {
      width: 48px; height: 48px; border-radius: 50%;
      object-fit: cover;
    }
    .identity-preview i {
      font-size: 28px; color: var(--gold); display: flex; justify-content: center; align-items: center;
      background: rgba(0,0,0,0.3); border-radius: 50%;
    }
    /* ===== MODAL PASSWORD ‚Äì PREMIUM ELEGAN ===== */
    .modal-overlay {
      position: fixed; top: 0; left: 0; width: 100%; height: 100%;
      background: rgba(0,0,0,0.8); backdrop-filter: blur(12px);
      display: flex; justify-content: center; align-items: center;
      z-index: 9999; visibility: hidden; opacity: 0;
      transition: opacity 0.3s ease, visibility 0.3s;
    }
    .modal-overlay.active { visibility: visible; opacity: 1; }
    .modal-card {
      background: linear-gradient(145deg, rgba(12,40,60,0.95), rgba(8,30,45,0.98));
      backdrop-filter: blur(20px);
      border: 1px solid rgba(255,215,100,0.5);
      border-radius: 48px;
      padding: 40px 35px;
      max-width: 460px; width: 90%;
      box-shadow: 0 20px 60px rgba(0,0,0,0.5), 0 0 0 1px rgba(255,200,0,0.2), 0 0 30px rgba(255,215,0,0.3);
      transform: scale(0.95);
      transition: transform 0.3s cubic-bezier(0.34,1.56,0.64,1), opacity 0.3s ease;
      position: relative;
      overflow: hidden;
      text-align: center;
    }
    .modal-overlay.active .modal-card { transform: scale(1); }
    .modal-card::after {
      content: '';
      position: absolute;
      top: -50%; left: -50%;
      width: 200%; height: 200%;
      background: radial-gradient(circle at 70% 30%, rgba(255,220,100,0.1), transparent 70%);
      opacity: 0.5;
      pointer-events: none;
    }
    .modal-icon-wrapper {
      display: flex;
      justify-content: center;
      align-items: center;
      margin-bottom: 20px;
    }
    .modal-lock-icon {
      font-size: 56px;
      color: #ffd966;
      text-shadow: 0 0 20px rgba(255,200,0,0.6);
      animation: lockPulse 3s infinite ease-in-out;
    }
    @keyframes lockPulse {
      0%, 100% { transform: scale(1); opacity: 0.9; }
      50% { transform: scale(1.05); opacity: 1; }
    }
    .modal-title {
      font-family: 'Amiri', serif;
      font-size: 2.2rem;
      font-weight: 700;
      color: #ffeaa5;
      margin-bottom: 8px;
      letter-spacing: 1px;
      text-shadow: 0 2px 10px rgba(255,200,0,0.3);
    }
    .modal-subtitle {
      color: #cfe9ff;
      font-size: 0.95rem;
      margin-bottom: 30px;
      opacity: 0.9;
    }
    .input-group {
      position: relative;
      display: flex;
      align-items: center;
      margin-bottom: 30px;
    }
    .input-icon {
      position: absolute;
      left: 18px;
      color: #ffd966;
      font-size: 1.1rem;
      z-index: 2;
    }
    .modal-input {
      width: 100%;
      padding: 16px 20px 16px 50px;
      background: rgba(0,0,0,0.4);
      border: 1.5px solid rgba(255,215,100,0.5);
      border-radius: 60px;
      color: white;
      font-size: 1.05rem;
      letter-spacing: 3px;
      transition: all 0.25s;
      backdrop-filter: blur(4px);
    }
    .modal-input:focus {
      border-color: #ffd966;
      box-shadow: 0 0 0 4px rgba(255,215,0,0.2), 0 0 20px rgba(255,200,0,0.3);
      outline: none;
      background: rgba(0,0,0,0.6);
    }
    .modal-input::placeholder {
      color: rgba(200,230,255,0.6);
      letter-spacing: normal;
      font-size: 0.95rem;
    }
    .modal-actions {
      display: flex;
      gap: 18px;
      justify-content: center;
      margin-bottom: 20px;
    }
    .modal-btn {
      padding: 14px 32px;
      border-radius: 60px;
      font-weight: 600;
      font-size: 1.05rem;
      cursor: pointer;
      border: none;
      display: inline-flex;
      align-items: center;
      gap: 10px;
      transition: all 0.2s cubic-bezier(0.25,0.46,0.45,0.94);
      box-shadow: 0 8px 16px rgba(0,0,0,0.2);
    }
    .modal-btn i { font-size: 1.1rem; }
    .modal-btn-primary {
      background: linear-gradient(145deg, #ffb347, #ff8c42);
      color: #0a1f2e;
      border: 1px solid #ffe99b;
      box-shadow: 0 0 15px rgba(255,180,60,0.5);
    }
    .modal-btn-primary:hover {
      background: linear-gradient(145deg, #ffa233, #ff6b2b);
      box-shadow: 0 0 25px rgba(255,160,0,0.7);
      transform: scale(1.02);
    }
    .modal-btn-secondary {
      background: rgba(255,255,255,0.08);
      color: #ffd966;
      border: 1px solid rgba(255,215,100,0.6);
      backdrop-filter: blur(4px);
    }
    .modal-btn-secondary:hover {
      background: rgba(255,200,100,0.15);
      border-color: #ffd966;
      color: #ffeaa5;
      transform: scale(1.02);
    }
    .modal-hint {
      color: #aad8ff;
      font-size: 0.85rem;
      margin-top: 15px;
      padding-top: 15px;
      border-top: 1px dashed rgba(255,215,100,0.3);
    }
    .modal-hint strong {
      color: #ffd966;
      background: rgba(0,0,0,0.3);
      padding: 2px 10px;
      border-radius: 30px;
      font-weight: 600;
    }
    /* ===== TOAST ===== */
    #toast {
      visibility: hidden; min-width: 300px;
      background: var(--toast-success); color: white;
      text-align: center; border-radius: 60px;
      padding: 16px 28px; position: fixed;
      bottom: 30px; left: 50%; transform: translateX(-50%);
      z-index: 99999; font-weight: 600;
      display: flex; align-items: center; gap: 12px;
      box-shadow: 0 10px 30px rgba(0,0,0,0.5);
      border: 1px solid rgba(255,255,255,0.3);
      backdrop-filter: blur(8px);
    }
    #toast.show { visibility: visible; animation: fadein 0.4s, fadeout 0.4s 3s; }
    @keyframes fadein { from { bottom: 0; opacity: 0; } to { bottom: 30px; opacity: 1; } }
    @keyframes fadeout { from { bottom: 30px; opacity: 1; } to { bottom: 0; opacity: 0; } }
    /* ===== CANVA EMBED MODAL ‚Äì BRILIAN! ===== */
    .canva-modal-overlay {
      position: fixed;
      top: 0;
      left: 0;
      width: 100%;
      height: 100%;
      background: rgba(0, 0, 0, 0.85);
      backdrop-filter: blur(12px);
      display: flex;
      justify-content: center;
      align-items: center;
      z-index: 999999;
      visibility: hidden;
      opacity: 0;
      transition: opacity 0.3s ease, visibility 0.3s;
    }
    .canva-modal-overlay.active {
      visibility: visible;
      opacity: 1;
    }
    .canva-modal-container {
      width: 90%;
      height: 85%;
      max-width: 1200px;
      background: rgba(10, 30, 45, 0.95);
      backdrop-filter: blur(20px);
      border: 2px solid rgba(255, 215, 100, 0.6);
      border-radius: 32px;
      box-shadow: 0 0 60px rgba(255, 200, 0, 0.4);
      display: flex;
      flex-direction: column;
      overflow: hidden;
      transform: scale(0.95);
      transition: transform 0.3s cubic-bezier(0.34, 1.56, 0.64, 1);
    }
    .canva-modal-overlay.active .canva-modal-container {
      transform: scale(1);
    }
    .canva-modal-header {
      display: flex;
      justify-content: space-between;
      align-items: center;
      padding: 16px 24px;
      border-bottom: 1px solid rgba(255, 215, 100, 0.3);
    }
    .canva-modal-header h3 {
      font-family: 'Amiri', serif;
      color: #ffeaa5;
      font-size: 1.5rem;
      margin: 0;
      display: flex;
      align-items: center;
      gap: 10px;
    }
    .canva-modal-header i {
      color: #ffd966;
    }
    .canva-close-btn {
      background: rgba(255,255,255,0.1);
      border: 1px solid rgba(255,215,100,0.5);
      color: #ffd966;
      width: 40px;
      height: 40px;
      border-radius: 50%;
      display: flex;
      justify-content: center;
      align-items: center;
      font-size: 1.3rem;
      cursor: pointer;
      transition: all 0.2s;
    }
    .canva-close-btn:hover {
      background: rgba(255,200,100,0.2);
      border-color: #ffd966;
      color: #fff4c2;
      transform: rotate(90deg);
    }
    .canva-iframe-wrapper {
      flex: 1;
      width: 100%;
      padding: 20px;
      box-sizing: border-box;
      position: relative;
    }
    .canva-iframe-wrapper iframe {
      width: 100%;
      height: 100%;
      border: none;
      border-radius: 20px;
      background: white;
    }
    .canva-loading {
      position: absolute;
      top: 50%;
      left: 50%;
      transform: translate(-50%, -50%);
      color: #ffd966;
      font-size: 1.2rem;
      display: flex;
      flex-direction: column;
      align-items: center;
      gap: 12px;
    }
    .canva-loading i {
      font-size: 3rem;
      animation: spin 1s linear infinite;
    }
    @keyframes spin {
      0% { transform: rotate(0deg); }
      100% { transform: rotate(360deg); }
    }
    /* ===== RESPONSIVE ===== */
    @media (max-width: 1000px) {
      .portal-container { padding: 20px; }
      .moon { width: 130px; height: 130px; top: 2%; right: 5%; }
      .identity-logo { top: 15px; right: 20px; width: 48px; height: 48px; }
    }
    @media (max-width: 500px) {
      .modal-card { padding: 30px 20px; }
      .modal-title { font-size: 1.8rem; }
      .modal-actions { flex-direction: column; }
      .modal-btn { justify-content: center; }
      .canva-modal-header h3 { font-size: 1.2rem; }
      .canva-modal-container { width: 95%; height: 80%; }
    }
    .password-strength { margin-bottom: 15px; }
    .accordion-toggle { cursor: pointer; }
    .rombel-links { display: none; }
    .rombel-links[style*="flex"] { display: flex !important; }
  </style>
</head>
<body>
  <div class="moon"></div>
  <div class="stars"></div>
  <div id="toast"><i class="fas fa-check-circle"></i> <span id="toast-message">Berhasil</span></div>

  <!-- MODAL PASSWORD ‚Äì PREMIUM ELEGAN -->
  <div id="passwordModal" class="modal-overlay" role="dialog" aria-label="Login Pengaturan">
    <div class="modal-card">
      <div class="modal-icon-wrapper">
        <i class="fas fa-lock modal-lock-icon"></i>
      </div>
      <h2 class="modal-title">Akses Pengaturan</h2>
      <p class="modal-subtitle">Masukkan password administrator</p>
      <div class="input-group">
        <span class="input-icon"><i class="fas fa-key"></i></span>
        <input type="password" id="modalPasswordInput" class="modal-input" 
               placeholder="Password" autocomplete="off" aria-label="Password">
      </div>
      <div class="modal-actions">
        <button class="modal-btn modal-btn-primary" id="modalSubmitBtn">
          <i class="fas fa-key"></i> Buka
        </button>
        <button class="modal-btn modal-btn-secondary" id="modalCancelBtn">
          <i class="fas fa-times"></i> Batal
        </button>
      </div>
      <p class="modal-hint">
        <i class="fas fa-info-circle"></i> Default: <strong>demo123</strong>
      </p>
    </div>
  </div>

  <!-- MODAL KONFIRMASI -->
  <div id="confirmModal" class="modal-overlay">
    <div class="modal-card">
      <i class="fas fa-question-circle" id="confirmIcon" style="font-size:56px; color:#ffd966;"></i>
      <h2 id="confirmTitle" class="modal-title" style="font-size:1.8rem;">Konfirmasi</h2>
      <p id="confirmMessage" style="color: white; margin-bottom: 25px;"></p>
      <div class="modal-actions">
        <button class="modal-btn modal-btn-primary" id="confirmOkBtn"><i class="fas fa-check"></i> Ya</button>
        <button class="modal-btn modal-btn-secondary" id="confirmCancelBtn"><i class="fas fa-times"></i> Batal</button>
      </div>
    </div>
  </div>

  <!-- CANVA EMBED MODAL ‚Äì FITUR BRILIAN BARU -->
  <div id="canvaModal" class="canva-modal-overlay">
    <div class="canva-modal-container">
      <div class="canva-modal-header">
        <h3><i class="fab fa-canva"></i> Canva e‚ÄëJurnal Ramadan</h3>
        <div class="canva-close-btn" id="closeCanvaModal">
          <i class="fas fa-times"></i>
        </div>
      </div>
      <div class="canva-iframe-wrapper">
        <div id="canvaLoading" class="canva-loading">
          <i class="fas fa-circle-notch"></i>
          <span>Memuat desain Canva...</span>
        </div>
        <iframe id="canvaIframe" src="about:blank" allowfullscreen style="display: none;"></iframe>
      </div>
    </div>
  </div>

  <div class="portal-container">
    <!-- LOGO IDENTITAS -->
    <div id="identityLogoContainer" class="identity-logo">
      <img id="identityLogoPreview" src="" alt="logo identitas" style="display: none;">
      <i id="identityLogoIcon" class="fas fa-star" style="display: flex;"></i>
    </div>

    <!-- HEADER -->
    <div class="brand">
      <div class="logo-container">
        <img id="logoPreview" src="" alt="Logo Sekolah" style="display: none;">
        <div id="logoPlaceholder" class="logo-placeholder"><i class="fas fa-mosque"></i></div>
      </div>
      <div class="title-tagline">
        <h1 id="schoolTitle">e-Jurnal Ramadan 1446 H</h1>
        <p id="tagline">‚ú® Cahaya Ilmu di Bulan Suci ‚ú®</p>
      </div>
    </div>

    <!-- MAIN TABS -->
    <div class="main-tab-nav">
      <button class="main-tab-btn active" id="mainTabHome"><i class="fas fa-home"></i> Beranda</button>
      <button class="main-tab-btn" id="mainTabSettings"><i class="fas fa-sliders-h"></i> Pengaturan</button>
    </div>

    <!-- KONTEN BERANDA -->
    <div id="homeContent" class="main-tab-content active">
      <div class="inner-tab-nav">
        <button class="inner-tab-btn active" id="innerTabSambutan"><i class="fas fa-star"></i> Sambutan</button>
        <button class="inner-tab-btn" id="innerTabTutorial"><i class="fas fa-video"></i> Tutorial</button>
        <button class="inner-tab-btn" id="innerTabAkses"><i class="fas fa-users"></i> User Siswa & Ortu</button>
        <button class="inner-tab-btn" id="innerTabProfil"><i class="fas fa-address-card"></i> Profil & Fitur</button>
      </div>

      <!-- SAMBUTAN -->
      <div id="innerSambutan" class="inner-tab-content active">
        <div class="ramadan-quote">
          <h2>üåô Marhaban Ya Ramadan</h2>
          <p>"Bulan yang penuh berkah, pintu ampunan terbuka lebar. Mari isi dengan e-Jurnal kebaikan."</p>
          <div id="ramadanInfoContainer" class="ramadan-info-card"></div>
        </div>
        <div class="welcome-principal">
          <div class="principal-photo">
            <img id="principalPhotoPreview" src="" alt="Kepala Sekolah" style="display: none;">
            <div id="principalPlaceholder" style="font-size:70px;"><i class="fas fa-user-tie"></i></div>
          </div>
          <div class="speech">
            <h3>Sambutan Kepala Sekolah</h3>
            <p id="speechText">Assalamu'alaikum wr. wb. Selamat menunaikan ibadah puasa. Dengan portal e-Jurnal Ramadan ini, kami berharap orang tua, siswa, dan guru dapat berkolaborasi mencatat amal kebaikan sehari-hari. Mari jadikan Ramadan kali ini penuh kemuliaan.</p>
            <p style="margin-top: 12px;"><strong id="principalName">‚Äì Dr. Hj. Aisyah Nur, M.Pd.</strong></p>
          </div>
        </div>
      </div>

      <!-- TUTORIAL -->
      <div id="innerTutorial" class="inner-tab-content">
        <div class="video-card">
          <div class="video-frame">
            <iframe id="youtubeVideo" src="https://www.youtube.com/embed/VIDEO_ID?controls=1&rel=0" allowfullscreen></iframe>
          </div>
          <div class="video-text">
            <h4>Tutorial Penggunaan APP</h4>
            <p>Panduan lengkap e-Jurnal untuk guru, siswa & ortu.</p>
            <span style="color: #ffeaa5;"><i class="fas fa-video"></i> Klik putar untuk menonton</span>
          </div>
        </div>
      </div>

      <!-- USER SISWA & ORTU -->
      <div id="innerAkses" class="inner-tab-content">
        <div class="filter-section">
          <label for="filterKelas"><i class="fas fa-filter"></i> Filter Kelas:</label>
          <select id="filterKelas" class="filter-select">
            <option value="all">Semua Kelas</option>
            <option value="1">Kelas 1</option>
            <option value="2">Kelas 2</option>
            <option value="3">Kelas 3</option>
            <option value="4">Kelas 4</option>
            <option value="5">Kelas 5</option>
            <option value="6">Kelas 6</option>
          </select>
        </div>
        <div id="classGridContainer" class="class-grid"></div>
        <div style="text-align: center;">
          <a href="#" id="mainCanvaLink" class="btn-canva-primary" target="_blank">
            <i class="fab fa-canva"></i> Aplikasi Utama Canva
          </a>
        </div>
      </div>

      <!-- PROFIL & FITUR -->
      <div id="innerProfil" class="inner-tab-content">
        <footer class="footer" style="margin-top:0;">
          <div class="footer-logo">
            <img id="footerLogoImg" src="" alt="logo" style="width:60px; height:60px; border-radius:16px; object-fit:cover; display:none;">
            <i id="footerLogoIcon" class="fas fa-mosque" style="font-size: 50px; color: #ffe087; display: none;"></i>
            <div class="footer-info">
              <h4 id="footerSchoolName">SDIT Al-Falah</h4>
              <span id="footerTagline">Bersama Raih Berkah Ramadan</span>
              <span id="footerAddress"><i class="fas fa-map-marker-alt"></i> Jl. Luminous No. 9, Jakarta</span>
            </div>
          </div>
          <div class="social">
            <a href="#" id="igLink" target="_blank"><i class="fab fa-instagram"></i></a>
            <a href="#" id="fbLink" target="_blank"><i class="fab fa-facebook"></i></a>
            <a href="#" id="ytLink" target="_blank"><i class="fab fa-youtube"></i></a>
            <a href="#" id="tiktokLink" target="_blank"><i class="fab fa-tiktok"></i></a>
          </div>
        </footer>
        <div class="copyright" id="copyrightText">¬© SDIT Al-Falah 2026</div>
      </div>
    </div>

    <!-- KONTEN PENGATURAN (PROTECTED) -->
    <div id="settingsContent" class="main-tab-content">
      <div class="settings-panel">
        <h2 style="color:#ffe08c; margin-bottom:20px;"><i class="fas fa-cog"></i> Pengaturan Premium</h2>
        
        <!-- Identitas & Branding -->
        <div class="setting-group">
          <h3><i class="fas fa-palette"></i> Identitas & Branding</h3>
          <div class="field"><label>Upload Logo</label><input type="file" id="uploadLogo" accept="image/*"></div>
          <div class="field"><label>Ikon FA</label><input type="text" id="inputLogoIcon" value="fas fa-mosque"></div>
          <div class="field"><label>Judul Portal</label><input type="text" id="inputTitle" value="e-Jurnal Ramadan 1446 H"></div>
          <div class="field"><label>Tagline</label><input type="text" id="inputTagline" value="‚ú® Cahaya Ilmu di Bulan Suci ‚ú®"></div>
          <div style="display: flex; gap: 10px;">
            <button class="btn-danger" id="clearLogoBtn"><i class="fas fa-times"></i> Hapus Logo</button>
          </div>
        </div>

        <!-- Kepala Sekolah -->
        <div class="setting-group">
          <h3><i class="fas fa-user-graduate"></i> Kepala Sekolah</h3>
          <div class="field"><label>Upload Foto</label><input type="file" id="uploadPrincipalPhoto" accept="image/*"></div>
          <div class="field"><label>Ikon Alternatif</label><input type="text" id="inputPrincipalIcon" value="fas fa-user-tie"></div>
          <div class="field"><label>Nama</label><input type="text" id="inputPrincipalName" value="Dr. Hj. Aisyah Nur, M.Pd."></div>
          <div class="field"><label>Teks Sambutan</label><textarea rows="2" id="inputSpeech">Assalamu'alaikum wr. wb. Selamat menunaikan ibadah puasa. Dengan portal e-Jurnal Ramadan ini, kami berharap orang tua, siswa, dan guru dapat berkolaborasi mencatat amal kebaikan sehari-hari. Mari jadikan Ramadan kali ini penuh kemuliaan.</textarea></div>
          <div style="display: flex; gap: 10px;">
            <button class="btn-danger" id="clearPrincipalBtn"><i class="fas fa-times"></i> Hapus Foto</button>
          </div>
        </div>

        <!-- Video Tutorial -->
        <div class="setting-group">
          <h3><i class="fas fa-video"></i> Video Tutorial</h3>
          <div class="field"><label>YouTube ID</label><input type="text" id="youtubeVideoId" value="VIDEO_ID"></div>
        </div>

        <!-- Tautan per Kelas -->
        <div class="setting-group">
          <h3><i class="fas fa-link"></i> Tautan per Kelas (A-D)</h3>
          <div id="settingsLinksContainer" style="max-height: 300px; overflow-y: auto; padding-right: 5px;"></div>
        </div>

        <!-- Footer & Copyright -->
        <div class="setting-group">
          <h3><i class="fas fa-shoe-prints"></i> Footer & Copyright</h3>
          <div class="field"><label>Nama Sekolah</label><input type="text" id="footerSchoolInput" value="SDIT Al-Falah"></div>
          <div class="field"><label>Tagline Footer</label><input type="text" id="footerTaglineInput" value="Bersama Raih Berkah Ramadan"></div>
          <div class="field"><label>Alamat</label><input type="text" id="footerAddressInput" value="Jl. Luminous No. 9, Jakarta"></div>
          <div class="field"><label>Instagram</label><input type="url" id="igUrl" value="#"></div>
          <div class="field"><label>Facebook</label><input type="url" id="fbUrl" value="#"></div>
          <div class="field"><label>YouTube</label><input type="url" id="ytUrl" value="#"></div>
          <div class="field"><label>TikTok</label><input type="url" id="tiktokUrl" value="#"></div>
          <div class="field"><label>Link Utama Canva</label><input type="url" id="mainCanvaUrl" value="https://www.canva.com/ramadan"></div>
          <div class="field"><label>Teks Copyright</label><input type="text" id="copyrightInput" value="¬© SDIT Al-Falah 2026"></div>
        </div>

        <!-- RAMADHAN & IDENTITAS -->
        <div class="setting-group">
          <h3><i class="fas fa-calendar-alt"></i> üìÖ Ramadhan & Identitas</h3>
          <div class="field">
            <label><i class="fas fa-calendar"></i> Tanggal 1 Ramadhan</label>
            <input type="date" id="ramadanStartDate" value="2026-03-01">
          </div>
          <div class="field">
            <label><i class="fas fa-id-badge"></i> Upload Logo Identitas</label>
            <input type="file" id="uploadIdentityLogo" accept="image/*">
          </div>
          <div class="field">
            <label>Ikon FA (alternatif)</label>
            <input type="text" id="inputIdentityIcon" placeholder="fas fa-star" value="fas fa-star">
          </div>
          <div class="field">
            <label>Pratinjau</label>
            <div id="identityPreviewContainer" class="identity-preview">
              <img id="identityPreviewImg" src="" alt="preview" style="display: none;">
              <i id="identityPreviewIcon" class="fas fa-star"></i>
              <span style="color: #e6f7ff;">Logo identitas (pojok kanan)</span>
            </div>
          </div>
          <div style="display: flex; gap: 10px;">
            <button class="btn-danger" id="clearIdentityBtn"><i class="fas fa-times"></i> Hapus Logo</button>
          </div>
        </div>

        <!-- Keamanan & Akses -->
        <div class="setting-group">
          <h3><i class="fas fa-shield-alt"></i> üîê Keamanan & Akses</h3>
          <div class="field"><label>Password Saat Ini</label><input type="password" id="currentPassword" placeholder="Masukkan password lama"></div>
          <div class="field"><label>Password Baru</label><input type="password" id="newPassword" placeholder="Minimal 6 karakter"></div>
          <div class="field"><label>Konfirmasi</label><input type="password" id="confirmPassword" placeholder="Ulangi password baru"></div>
          <div class="password-strength" style="display: flex; align-items: center; gap: 15px; margin-bottom: 15px;">
            <span>Kekuatan:</span>
            <div style="width: 100px; height: 6px; background: rgba(255,255,255,0.2); border-radius: 10px;">
              <div id="strengthFill" style="width: 0; height: 100%; border-radius: 10px;"></div>
            </div>
            <span id="strengthText">Lemah</span>
          </div>
          <div style="display: flex; gap: 15px; flex-wrap: wrap;">
            <button class="btn-primary" id="changePasswordBtn"><i class="fas fa-save"></i> Perbarui Password</button>
            <button class="btn-warning" id="logoutSettingsBtn"><i class="fas fa-sign-out-alt"></i> Logout</button>
          </div>
          <p style="color: #ffd966; margin-top: 15px;"><i class="fas fa-info-circle"></i> Password default: <strong>demo123</strong></p>
        </div>

        <!-- Tombol Simpan & Reset -->
        <div class="btn-group">
          <button class="btn-primary" id="saveSettingsBtn"><i class="fas fa-save"></i> Simpan Semua Pengaturan</button>
          <button class="btn-secondary" id="resetSettingsBtn"><i class="fas fa-undo-alt"></i> Reset ke Default</button>
        </div>
      </div>
    </div>
  </div>

  <script>
    (function() {
      'use strict';
      // ==================== KONSTANTA ====================
      const KELAS_LIST = [1, 2, 3, 4, 5, 6];
      const HURUF_ROMBEL = ['A', 'B', 'C', 'D'];
      const STORAGE_KEY = 'eJurnalRamadanPremiumV3';
      const AUTH_SESSION_KEY = 'settingsAuthV3';
      const FIRST_VISIT_KEY = 'eJurnal_firstVisitV3';
      const PREF_CLASS_KEY = 'eJurnal_prefClassV3';

      // ==================== STATE DEFAULT ====================
      let settings = {
        // Identitas
        logoIcon: 'fas fa-mosque',
        logoImage: null,
        title: 'e-Jurnal Ramadan 1446 H',
        tagline: '‚ú® Cahaya Ilmu di Bulan Suci ‚ú®',
        
        // Kepsek
        principalIcon: 'fas fa-user-tie',
        principalImage: null,
        principalName: 'Dr. Hj. Aisyah Nur, M.Pd.',
        speech: 'Assalamu\'alaikum wr. wb. Selamat menunaikan ibadah puasa. Dengan portal e-Jurnal Ramadan ini, kami berharap orang tua, siswa, dan guru dapat berkolaborasi mencatat amal kebaikan sehari-hari. Mari jadikan Ramadan kali ini penuh kemuliaan.',
        
        // Video
        youtubeId: 'VIDEO_ID',
        
        // Tautan Kelas
        gsheetLinks: {},
        canvaLinks: {},
        
        // Footer
        footerSchool: 'SDIT Al-Falah',
        footerTagline: 'Bersama Raih Berkah Ramadan',
        footerAddress: 'Jl. Luminous No. 9, Jakarta',
        social: { ig: '#', fb: '#', yt: '#', tiktok: '#' },
        mainCanvaUrl: 'https://www.canva.com/ramadan',
        copyrightText: '¬© SDIT Al-Falah 2026',
        
        // Keamanan
        adminPassword: 'demo123',
        
        // RAMADHAN & IDENTITAS
        ramadanStartDate: '2026-03-01',
        identityLogo: null,
        identityIcon: 'fas fa-star'
      };

      // ==================== INISIALISASI LINK DEFAULT ====================
      function initDefaultLinks() {
        KELAS_LIST.forEach(k => {
          HURUF_ROMBEL.forEach(h => {
            const key = `${k}${h}`;
            if (!settings.gsheetLinks[key]) {
              settings.gsheetLinks[key] = `https://docs.google.com/spreadsheets/d/kelas${key}?tab=kelas${k}`;
            }
            if (!settings.canvaLinks[key]) {
              settings.canvaLinks[key] = `https://www.canva.com/design/kelas${key}/view`;
            }
          });
        });
      }

      // ==================== LOAD / SAVE ====================
      function loadSettings() {
        const stored = localStorage.getItem(STORAGE_KEY);
        if (stored) {
          try {
            const parsed = JSON.parse(stored);
            settings = { ...settings, ...parsed };
          } catch (e) {}
        }
        initDefaultLinks();
        if (!settings.adminPassword) settings.adminPassword = 'demo123';
        if (!settings.ramadanStartDate) settings.ramadanStartDate = '2026-03-01';
        if (!settings.identityIcon) settings.identityIcon = 'fas fa-star';
      }
      function saveSettingsToStorage() {
        localStorage.setItem(STORAGE_KEY, JSON.stringify(settings));
      }

      // ==================== TOAST ====================
      function showToast(msg, type = 'success') {
        const toast = document.getElementById('toast');
        document.getElementById('toast-message').textContent = msg;
        toast.style.background = type === 'success' ? '#00b894' : type === 'error' ? '#d63031' : '#fdcb6e';
        toast.classList.add('show');
        setTimeout(() => toast.classList.remove('show'), 3300);
      }

      // ==================== VALIDASI URL ====================
      function validateUrl(url) {
        if (!url || url === '#') return '#';
        url = url.trim();
        if (url.startsWith('http://') || url.startsWith('https://')) return url;
        if (url.includes('.') && !url.includes(' ')) return 'https://' + url;
        return '#';
      }

      // ==================== AUTHENTIKASI ====================
      function isSettingsAuthenticated() {
        return sessionStorage.getItem(AUTH_SESSION_KEY) === 'true';
      }
      function setSettingsAuthenticated(value) {
        if (value) sessionStorage.setItem(AUTH_SESSION_KEY, 'true');
        else sessionStorage.removeItem(AUTH_SESSION_KEY);
      }

      // ==================== MODAL ====================
      const modal = document.getElementById('passwordModal');
      const modalInput = document.getElementById('modalPasswordInput');
      const modalSubmit = document.getElementById('modalSubmitBtn');
      const modalCancel = document.getElementById('modalCancelBtn');
      const confirmModal = document.getElementById('confirmModal');
      const confirmTitle = document.getElementById('confirmTitle');
      const confirmMessage = document.getElementById('confirmMessage');
      const confirmOkBtn = document.getElementById('confirmOkBtn');
      const confirmCancelBtn = document.getElementById('confirmCancelBtn');
      let confirmCallback = null;

      function showPasswordModal() {
        modal.classList.add('active');
        modalInput.value = '';
        modalInput.focus();
      }
      function hidePasswordModal() { modal.classList.remove('active'); }
      function verifyPassword(inputPwd) { return inputPwd === settings.adminPassword; }

      function showConfirmModal(title, message, icon, callback) {
        confirmTitle.innerText = title;
        confirmMessage.innerText = message;
        document.getElementById('confirmIcon').className = icon || 'fas fa-question-circle';
        confirmModal.classList.add('active');
        confirmCallback = callback;
      }
      function hideConfirmModal() { confirmModal.classList.remove('active'); confirmCallback = null; }
      confirmOkBtn.addEventListener('click', function() { if (confirmCallback) confirmCallback(); hideConfirmModal(); });
      confirmCancelBtn.addEventListener('click', hideConfirmModal);

      // ==================== FITUR RAMADHAN ====================
      function formatDateIndonesian(dateStr) {
        if (!dateStr) return '-';
        const d = new Date(dateStr + 'T12:00:00');
        if (isNaN(d.getTime())) return '-';
        return d.toLocaleDateString('id-ID', { day: 'numeric', month: 'long', year: 'numeric' });
      }
      function getRamadanDay(startDateStr) {
        if (!startDateStr) return null;
        const today = new Date();
        today.setHours(0,0,0,0);
        const start = new Date(startDateStr + 'T00:00:00');
        if (isNaN(start.getTime())) return null;
        const diffTime = today - start;
        const diffDays = Math.floor(diffTime / (1000 * 60 * 60 * 24)) + 1;
        return diffDays > 0 ? diffDays : null;
      }
      function renderRamadanInfo() {
        const container = document.getElementById('ramadanInfoContainer');
        if (!container) return;
        const startDate = settings.ramadanStartDate || '2026-03-01';
        const formatted = formatDateIndonesian(startDate);
        const day = getRamadanDay(startDate);
        let html = `<span><i class="fas fa-calendar-alt"></i> 1 Ramadhan 1446 H: ${formatted}</span>`;
        if (day && day > 0) {
          html += `<span><i class="fas fa-moon"></i> Hari ke-${day} Ramadhan 1446 H</span>`;
        } else {
          html += `<span><i class="fas fa-moon"></i> Menjelang Ramadhan 1446 H</span>`;
        }
        container.innerHTML = html;
      }

      // ==================== FITUR LOGO IDENTITAS ====================
      function renderIdentityLogo() {
        const container = document.getElementById('identityLogoContainer');
        const img = document.getElementById('identityLogoPreview');
        const icon = document.getElementById('identityLogoIcon');
        if (!container) return;
        if (settings.identityLogo) {
          img.src = settings.identityLogo;
          img.style.display = 'block';
          icon.style.display = 'none';
        } else {
          img.style.display = 'none';
          icon.style.display = 'flex';
          icon.className = settings.identityIcon || 'fas fa-star';
        }
        container.style.display = 'flex';
      }
      function updateIdentityPreview() {
        const previewImg = document.getElementById('identityPreviewImg');
        const previewIcon = document.getElementById('identityPreviewIcon');
        if (settings.identityLogo) {
          previewImg.src = settings.identityLogo;
          previewImg.style.display = 'block';
          previewIcon.style.display = 'none';
        } else {
          previewImg.style.display = 'none';
          previewIcon.style.display = 'flex';
          previewIcon.className = settings.identityIcon || 'fas fa-star';
        }
      }

      // ==================== RENDER CARD GRID ====================
      function renderClassGrid(filterKelas = 'all') {
        const container = document.getElementById('classGridContainer');
        if (!container) return;
        container.innerHTML = '';
        KELAS_LIST.forEach(kelas => {
          if (filterKelas !== 'all' && kelas != filterKelas) return;
          const card = document.createElement('div');
          card.className = 'class-card';
          let html = `<div class="class-header"><h3>Kelas ${kelas}</h3><i class="fas fa-users"></i></div><div class="rombel-links-card">`;
          HURUF_ROMBEL.forEach(huruf => {
            const key = `${kelas}${huruf}`;
            const sheetLink = settings.gsheetLinks[key] || '#';
            const canvaLink = settings.canvaLinks[key] || '#';
            html += `<div class="rombel-item"><span class="rombel-label">Kelas ${key}</span>
                    <div class="rombel-actions">
                      <a href="${sheetLink}" class="btn-link btn-sheet" target="_blank"><i class="fas fa-file-excel"></i> Sheet</a>
                      <a href="${canvaLink}" class="btn-link btn-canva" target="_blank"><i class="fab fa-canva"></i> Canva</a>
                    </div></div>`;
          });
          html += '</div>';
          card.innerHTML = html;
          container.appendChild(card);
        });
      }

      // ==================== RENDER SETTINGS LINKS ====================
      function renderSettingsLinks() {
        const container = document.getElementById('settingsLinksContainer');
        if (!container) return;
        container.innerHTML = '';
        KELAS_LIST.forEach(kelas => {
          const div = document.createElement('div');
          div.style.background = 'rgba(0,0,0,0.2)'; div.style.borderRadius = '20px'; div.style.marginBottom = '12px';
          div.innerHTML = `
            <button class="accordion-toggle" type="button" style="width:100%; background:rgba(0,0,0,0.2); border:none; color:#ffda88; font-size:1.1rem; padding:12px 18px; text-align:left; display:flex; justify-content:space-between; align-items:center; border-radius:20px;">
              <span><i class="fas fa-layer-group"></i> Kelas ${kelas} (A-D)</span>
              <i class="fas fa-chevron-down" style="transition: transform 0.2s;"></i>
            </button>
            <div class="rombel-links" style="display: none; padding:15px; background:rgba(0,0,0,0.1); border-radius:0 0 20px 20px;"></div>
          `;
          const panel = div.querySelector('.rombel-links');
          HURUF_ROMBEL.forEach(huruf => {
            const key = `${kelas}${huruf}`;
            const row = document.createElement('div');
            row.style.display = 'flex'; row.style.gap = '12px'; row.style.marginBottom = '12px'; row.style.flexWrap = 'wrap';
            row.innerHTML = `
              <span style="min-width:85px; color:#fbffc4;"><i class="fas fa-users"></i> Kelas ${key}</span>
              <input type="url" class="gsheet-input" data-key="${key}" placeholder="Google Sheet link" value="${settings.gsheetLinks[key] || ''}" style="flex:1; padding:10px 16px; background:#103545; border:1px solid #ffe28c; border-radius:40px; color:white;">
              <input type="url" class="canva-input" data-key="${key}" placeholder="Canva link" value="${settings.canvaLinks[key] || ''}" style="flex:1; padding:10px 16px; background:#103545; border:1px solid #ffe28c; border-radius:40px; color:white;">
            `;
            panel.appendChild(row);
          });
          container.appendChild(div);
          div.querySelector('.accordion-toggle').addEventListener('click', function(e) {
            e.preventDefault();
            const p = this.nextElementSibling;
            const icon = this.querySelector('.fa-chevron-down');
            if (p.style.display === 'flex') {
              p.style.display = 'none';
              icon.style.transform = 'rotate(0deg)';
            } else {
              p.style.display = 'flex';
              p.style.flexDirection = 'column';
              icon.style.transform = 'rotate(180deg)';
            }
          });
        });
      }

      // ==================== APPLY UI ====================
      function applyAllUI() {
        // Logo
        const logoPreview = document.getElementById('logoPreview');
        const logoPlaceholder = document.getElementById('logoPlaceholder');
        if (settings.logoImage) {
          logoPreview.src = settings.logoImage;
          logoPreview.style.display = 'block';
          logoPlaceholder.style.display = 'none';
        } else {
          logoPreview.style.display = 'none';
          logoPlaceholder.style.display = 'block';
          logoPlaceholder.innerHTML = `<i class="${settings.logoIcon}"></i>`;
        }
        document.getElementById('schoolTitle').innerText = settings.title;
        document.getElementById('tagline').innerText = settings.tagline;

        // Kepsek
        const principalImg = document.getElementById('principalPhotoPreview');
        const principalPlace = document.getElementById('principalPlaceholder');
        if (settings.principalImage) {
          principalImg.src = settings.principalImage;
          principalImg.style.display = 'block';
          principalPlace.style.display = 'none';
        } else {
          principalImg.style.display = 'none';
          principalPlace.style.display = 'flex';
          principalPlace.innerHTML = `<i class="${settings.principalIcon}"></i>`;
        }
        document.getElementById('principalName').innerHTML = `‚Äì ${settings.principalName}`;
        document.getElementById('speechText').innerHTML = settings.speech;

        // YouTube
        document.getElementById('youtubeVideo').src = `https://www.youtube.com/embed/${settings.youtubeId}?controls=1&rel=0`;

        // Grid Kelas
        const filterVal = document.getElementById('filterKelas')?.value || 'all';
        renderClassGrid(filterVal);

        // Footer
        document.getElementById('footerSchoolName').innerText = settings.footerSchool;
        document.getElementById('footerTagline').innerText = settings.footerTagline;
        document.getElementById('footerAddress').innerHTML = `<i class="fas fa-map-marker-alt"></i> ${settings.footerAddress}`;
        const footerImg = document.getElementById('footerLogoImg');
        const footerIcon = document.getElementById('footerLogoIcon');
        if (settings.logoImage) {
          footerImg.src = settings.logoImage;
          footerImg.style.display = 'block';
          footerIcon.style.display = 'none';
        } else {
          footerImg.style.display = 'none';
          footerIcon.style.display = 'block';
          footerIcon.className = settings.logoIcon;
        }
        document.getElementById('igLink').href = settings.social.ig || '#';
        document.getElementById('fbLink').href = settings.social.fb || '#';
        document.getElementById('ytLink').href = settings.social.yt || '#';
        document.getElementById('tiktokLink').href = settings.social.tiktok || '#';
        document.getElementById('mainCanvaLink').href = settings.mainCanvaUrl || '#';
        document.getElementById('copyrightText').innerText = settings.copyrightText || '¬© SDIT Al-Falah 2026';

        // RAMADHAN & IDENTITAS
        renderRamadanInfo();
        renderIdentityLogo();
      }

      // ==================== SYNC SETTINGS ====================
      function syncSettingsFromInputs() {
        settings.title = document.getElementById('inputTitle').value;
        settings.tagline = document.getElementById('inputTagline').value;
        settings.logoIcon = document.getElementById('inputLogoIcon').value;
        settings.principalIcon = document.getElementById('inputPrincipalIcon').value;
        settings.principalName = document.getElementById('inputPrincipalName').value;
        settings.speech = document.getElementById('inputSpeech').value;
        settings.youtubeId = document.getElementById('youtubeVideoId').value;
        settings.footerSchool = document.getElementById('footerSchoolInput').value;
        settings.footerTagline = document.getElementById('footerTaglineInput').value;
        settings.footerAddress = document.getElementById('footerAddressInput').value;
        settings.social.ig = validateUrl(document.getElementById('igUrl').value);
        settings.social.fb = validateUrl(document.getElementById('fbUrl').value);
        settings.social.yt = validateUrl(document.getElementById('ytUrl').value);
        settings.social.tiktok = validateUrl(document.getElementById('tiktokUrl').value);
        settings.mainCanvaUrl = validateUrl(document.getElementById('mainCanvaUrl').value);
        settings.copyrightText = document.getElementById('copyrightInput').value;

        // Tautan kelas
        document.querySelectorAll('.gsheet-input').forEach(inp => {
          if (inp.dataset.key) settings.gsheetLinks[inp.dataset.key] = validateUrl(inp.value);
        });
        document.querySelectorAll('.canva-input').forEach(inp => {
          if (inp.dataset.key) settings.canvaLinks[inp.dataset.key] = validateUrl(inp.value);
        });

        // Ramadhan & Identitas
        settings.ramadanStartDate = document.getElementById('ramadanStartDate').value;
        settings.identityIcon = document.getElementById('inputIdentityIcon').value;
      }

      // ==================== RESET KE DEFAULT ====================
      function resetToDefault() {
        showConfirmModal('Reset ke Default', 'Semua kustomisasi akan hilang. Lanjutkan?', 'fas fa-exclamation-triangle', function() {
          localStorage.removeItem(STORAGE_KEY);
          sessionStorage.removeItem(AUTH_SESSION_KEY);
          location.reload();
        });
      }

      // ==================== PASSWORD STRENGTH ====================
      function evaluatePasswordStrength(pwd) {
        if (pwd.length < 6) return 0;
        let strength = 0;
        if (pwd.length >= 8) strength++;
        if (/[a-z]/.test(pwd) && /[A-Z]/.test(pwd)) strength++;
        if (/[0-9]/.test(pwd)) strength++;
        if (/[^a-zA-Z0-9]/.test(pwd)) strength++;
        return strength;
      }
      function updateStrengthIndicator(pwd) {
        const fill = document.getElementById('strengthFill');
        const text = document.getElementById('strengthText');
        if (!fill || !text) return;
        if (pwd.length < 6) {
          fill.style.width = '20%'; fill.style.background = '#e74c3c'; text.innerText = 'Lemah (min 6)';
        } else if (evaluatePasswordStrength(pwd) <= 1) {
          fill.style.width = '33%'; fill.style.background = '#e74c3c'; text.innerText = 'Lemah';
        } else if (evaluatePasswordStrength(pwd) === 2) {
          fill.style.width = '66%'; fill.style.background = '#f39c12'; text.innerText = 'Sedang';
        } else {
          fill.style.width = '100%'; fill.style.background = '#00b894'; text.innerText = 'Kuat';
        }
      }

      // ==================== FITUR 7 HARI CERDAS ====================
      function initSmartSevenDays() {
        let firstVisit = localStorage.getItem(FIRST_VISIT_KEY);
        if (!firstVisit) {
          firstVisit = Date.now().toString();
          localStorage.setItem(FIRST_VISIT_KEY, firstVisit);
        }
        const daysSince = Math.floor((Date.now() - parseInt(firstVisit)) / (1000 * 3600 * 24));
        const isSevenDaysPassed = daysSince >= 7;
        let preferredClass = localStorage.getItem(PREF_CLASS_KEY) || 'all';
        const filterSelect = document.getElementById('filterKelas');
        if (filterSelect) {
          filterSelect.value = preferredClass;
          renderClassGrid(preferredClass);
        }
        if (isSevenDaysPassed) {
          document.getElementById('innerTabAkses').click();
        }
      }

      // ==================== REFRESH FORM SETTINGS ====================
      function refreshSettingsForm() {
        document.getElementById('inputTitle').value = settings.title;
        document.getElementById('inputTagline').value = settings.tagline;
        document.getElementById('inputLogoIcon').value = settings.logoIcon;
        document.getElementById('inputPrincipalIcon').value = settings.principalIcon;
        document.getElementById('inputPrincipalName').value = settings.principalName;
        document.getElementById('inputSpeech').value = settings.speech;
        document.getElementById('youtubeVideoId').value = settings.youtubeId;
        document.getElementById('footerSchoolInput').value = settings.footerSchool;
        document.getElementById('footerTaglineInput').value = settings.footerTagline;
        document.getElementById('footerAddressInput').value = settings.footerAddress;
        document.getElementById('igUrl').value = settings.social.ig;
        document.getElementById('fbUrl').value = settings.social.fb;
        document.getElementById('ytUrl').value = settings.social.yt;
        document.getElementById('tiktokUrl').value = settings.social.tiktok;
        document.getElementById('mainCanvaUrl').value = settings.mainCanvaUrl;
        document.getElementById('copyrightInput').value = settings.copyrightText;
        
        // Ramadhan & Identitas
        document.getElementById('ramadanStartDate').value = settings.ramadanStartDate || '2026-03-01';
        document.getElementById('inputIdentityIcon').value = settings.identityIcon || 'fas fa-star';
        updateIdentityPreview();
        
        renderSettingsLinks();
      }

      // ==================== CANVA EMBED ‚Äì FITUR BRILIAN ====================
      const canvaModal = document.getElementById('canvaModal');
      const canvaIframe = document.getElementById('canvaIframe');
      const canvaLoading = document.getElementById('canvaLoading');
      const closeCanvaBtn = document.getElementById('closeCanvaModal');

      function buildCanvaEmbedUrl(url) {
        if (!url || url === '#') return null;
        try {
          // Jika sudah embed
          if (url.includes('/embed')) return url;
          
          // Pola: https://www.canva.com/design/.../view
          const designMatch = url.match(/(https:\/\/[^\/]+\/design\/[^\/?#]+)/i);
          if (designMatch) {
            let base = designMatch[1];
            base = base.replace(/\/[^\/]+$/, '');
            return `${base}/embed?referer=e-jurnal-ramadan`;
          }
          
          // Fallback
          if (url.endsWith('/')) return `${url}embed`;
          return `${url}/embed`;
        } catch (e) {
          return null;
        }
      }

      function openCanvaEmbed(originalUrl) {
        const embedUrl = buildCanvaEmbedUrl(originalUrl);
        if (!embedUrl) {
          // Fallback buka tab baru
          window.open(originalUrl, '_blank');
          return;
        }

        canvaLoading.style.display = 'flex';
        canvaIframe.style.display = 'none';
        canvaIframe.src = embedUrl;
        canvaModal.classList.add('active');
        document.body.style.overflow = 'hidden';

        canvaIframe.onload = function() {
          canvaLoading.style.display = 'none';
          canvaIframe.style.display = 'block';
        };
      }

      function closeCanvaEmbed() {
        canvaModal.classList.remove('active');
        document.body.style.overflow = '';
        setTimeout(() => {
          if (!canvaModal.classList.contains('active')) {
            canvaIframe.src = 'about:blank';
          }
        }, 300);
      }

      // Attach Canva listeners
      function attachCanvaListeners() {
        // Tombol Canva di card grid
        document.querySelectorAll('.btn-canva').forEach(btn => {
          btn.addEventListener('click', function(e) {
            e.preventDefault();
            const url = this.href;
            openCanvaEmbed(url);
          });
        });

        // Tombol utama Canva
        const mainCanva = document.getElementById('mainCanvaLink');
        if (mainCanva) {
          mainCanva.addEventListener('click', function(e) {
            e.preventDefault();
            const url = this.href;
            openCanvaEmbed(url);
          });
        }
      }

      // ==================== BIND EVENTS ====================
      function bindEvents() {
        // Main Tabs
        document.getElementById('mainTabHome').addEventListener('click', function() {
          document.getElementById('mainTabHome').classList.add('active');
          document.getElementById('mainTabSettings').classList.remove('active');
          document.getElementById('homeContent').classList.add('active');
          document.getElementById('settingsContent').classList.remove('active');
        });

        document.getElementById('mainTabSettings').addEventListener('click', function(e) {
          e.preventDefault();
          if (isSettingsAuthenticated()) {
            document.getElementById('mainTabSettings').classList.add('active');
            document.getElementById('mainTabHome').classList.remove('active');
            document.getElementById('settingsContent').classList.add('active');
            document.getElementById('homeContent').classList.remove('active');
            refreshSettingsForm();
          } else {
            showPasswordModal();
          }
        });

        // Modal Password
        modalSubmit.addEventListener('click', function() {
          const pwd = modalInput.value;
          if (verifyPassword(pwd)) {
            setSettingsAuthenticated(true);
            hidePasswordModal();
            document.getElementById('mainTabSettings').click();
            showToast('Akses diberikan', 'success');
          } else {
            showToast('Password salah!', 'error');
            modalInput.value = '';
            modalInput.focus();
          }
        });
        modalCancel.addEventListener('click', hidePasswordModal);
        modalInput.addEventListener('keypress', function(e) { if (e.key === 'Enter') modalSubmit.click(); });

        // Logout
        document.getElementById('logoutSettingsBtn').addEventListener('click', function() {
          showConfirmModal('Logout', 'Anda akan keluar dari Pengaturan. Lanjutkan?', 'fas fa-sign-out-alt', function() {
            setSettingsAuthenticated(false);
            document.getElementById('mainTabHome').click();
            showToast('Anda telah logout', 'success');
          });
        });

        // Ganti Password
        document.getElementById('changePasswordBtn').addEventListener('click', function() {
          const current = document.getElementById('currentPassword').value;
          const newPwd = document.getElementById('newPassword').value;
          const confirm = document.getElementById('confirmPassword').value;
          if (!verifyPassword(current)) { showToast('Password saat ini salah!', 'error'); return; }
          if (newPwd.length < 6) { showToast('Password baru minimal 6 karakter', 'error'); return; }
          if (newPwd !== confirm) { showToast('Konfirmasi password tidak cocok', 'error'); return; }
          settings.adminPassword = newPwd;
          saveSettingsToStorage();
          showToast('Password berhasil diperbarui!', 'success');
          document.getElementById('currentPassword').value = '';
          document.getElementById('newPassword').value = '';
          document.getElementById('confirmPassword').value = '';
          updateStrengthIndicator('');
        });

        // Password Strength
        document.getElementById('newPassword').addEventListener('input', function(e) {
          updateStrengthIndicator(e.target.value);
        });

        // Hapus Logo Sekolah
        document.getElementById('clearLogoBtn').addEventListener('click', function() {
          settings.logoImage = null;
          settings.logoIcon = 'fas fa-mosque';
          document.getElementById('inputLogoIcon').value = 'fas fa-mosque';
          applyAllUI();
          showToast('Logo dihapus, menggunakan ikon default', 'info');
        });

        // Hapus Foto Kepsek
        document.getElementById('clearPrincipalBtn').addEventListener('click', function() {
          settings.principalImage = null;
          settings.principalIcon = 'fas fa-user-tie';
          document.getElementById('inputPrincipalIcon').value = 'fas fa-user-tie';
          applyAllUI();
          showToast('Foto Kepsek dihapus', 'info');
        });

        // Upload Logo Sekolah
        document.getElementById('uploadLogo').addEventListener('change', function(e) {
          if (e.target.files[0]) {
            const reader = new FileReader();
            reader.onload = ev => { settings.logoImage = ev.target.result; settings.logoIcon = ''; applyAllUI(); };
            reader.readAsDataURL(e.target.files[0]);
          }
        });

        // Upload Foto Kepsek
        document.getElementById('uploadPrincipalPhoto').addEventListener('change', function(e) {
          if (e.target.files[0]) {
            const reader = new FileReader();
            reader.onload = ev => { settings.principalImage = ev.target.result; settings.principalIcon = ''; applyAllUI(); };
            reader.readAsDataURL(e.target.files[0]);
          }
        });

        // UPLOAD LOGO IDENTITAS
        document.getElementById('uploadIdentityLogo').addEventListener('change', function(e) {
          if (e.target.files[0]) {
            const reader = new FileReader();
            reader.onload = ev => {
              settings.identityLogo = ev.target.result;
              updateIdentityPreview();
              renderIdentityLogo();
            };
            reader.readAsDataURL(e.target.files[0]);
          }
        });

        // HAPUS LOGO IDENTITAS
        document.getElementById('clearIdentityBtn').addEventListener('click', function() {
          settings.identityLogo = null;
          settings.identityIcon = 'fas fa-star';
          document.getElementById('inputIdentityIcon').value = 'fas fa-star';
          updateIdentityPreview();
          renderIdentityLogo();
          showToast('Logo identitas dihapus', 'info');
        });

        // Input Ikon Identitas
        document.getElementById('inputIdentityIcon').addEventListener('input', function() {
          settings.identityIcon = this.value;
          updateIdentityPreview();
          renderIdentityLogo();
        });

        // Simpan Semua Pengaturan
        document.getElementById('saveSettingsBtn').addEventListener('click', function() {
          syncSettingsFromInputs();
          saveSettingsToStorage();
          applyAllUI();
          showToast('Semua pengaturan berhasil disimpan!', 'success');
        });

        // Reset
        document.getElementById('resetSettingsBtn').addEventListener('click', resetToDefault);

        // Inner Tabs
        const innerBtns = {
          innerTabSambutan: 'innerSambutan',
          innerTabTutorial: 'innerTutorial',
          innerTabAkses: 'innerAkses',
          innerTabProfil: 'innerProfil'
        };
        for (let [btnId, contentId] of Object.entries(innerBtns)) {
          document.getElementById(btnId).addEventListener('click', function() {
            Object.values(innerBtns).forEach(id => document.getElementById(id).classList.remove('active'));
            document.getElementById(contentId).classList.add('active');
            document.querySelectorAll('.inner-tab-btn').forEach(btn => btn.classList.remove('active'));
            this.classList.add('active');
          });
        }

        // Filter Kelas
        const filterSelect = document.getElementById('filterKelas');
        if (filterSelect) {
          filterSelect.addEventListener('change', function(e) {
            const val = e.target.value;
            localStorage.setItem(PREF_CLASS_KEY, val);
            renderClassGrid(val);
          });
        }

        // Canva Modal Close
        closeCanvaBtn.addEventListener('click', closeCanvaEmbed);
        canvaModal.addEventListener('click', function(e) {
          if (e.target === canvaModal) closeCanvaEmbed();
        });
        document.addEventListener('keydown', function(e) {
          if (e.key === 'Escape' && canvaModal.classList.contains('active')) {
            closeCanvaEmbed();
          }
        });

        // Attach Canva listeners (juga akan di-trigger setelah render ulang grid)
        attachCanvaListeners();
      }

      // ==================== INIT ====================
      loadSettings();
      initDefaultLinks();
      applyAllUI();
      renderSettingsLinks();
      bindEvents();
      initSmartSevenDays();
      refreshSettingsForm();
      updateStrengthIndicator('');
    })();
  </script>
</body>
</html>